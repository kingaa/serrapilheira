---
output:
  md_document:
    df_print: kable
---

## Inference for Disease Dynamics<br>Course Materials

### Required software

The codes require, at a minimum, [**R**](https://cran.r-project.org/) version 4.3 and [**pomp**](https://kingaa.github.io/pomp/) version 5.6.
Windows users must also have the appropriate version of [**Rtools**](https://cran.r-project.org/bin/windows/Rtools/) installed.
The `prep` directory contains scripts that will install other needed packages and test the user's installation.

A [Github Action](https://github.com/kingaa/serrapilheira/actions) checks that these installations and actions succeed on a variety of current and legacy platforms:

[![install-test](https://github.com/kingaa/serrapilheira/actions/workflows/install-test.yml/badge.svg)](https://github.com/kingaa/serrapilheira/actions/workflows/install-test.yml)

----------------------------

### Compilation

Full compilation of all the materials can be accomplished by running `make` in the root directory.
This requires substantial resources.
For this reason, the most expensive computations are archived using the facilities provided for the purpose in **pomp**.
Compilation with these archives in place requires much less time than does compilation from scratch.
The following gives an indication of the size of the archives and the time required for their computation on a linux cluster with 250&nbsp;cpus.

```{r}
#| echo: false
#| message: false
library(tidyverse)
options(digits=3,knitr.kable.NA="")

gettime <- function (path) {
  if (grepl(".rds",path)) {
    readRDS(path) |> attr("system.time") |> getElement(3)
  } else if (grepl(".rda",path)) {
    e <- new.env()
    load(path,envir=e)
    e$.system.time[3]
  } else {
    NA_real_
  }
}

list.files(pattern=r"{.+\.rd[as]$}",recursive=TRUE) |> 
  {\(x) data.frame(
          path=x,
          dir=dirname(x),
          file=basename(x),
          size=file.size(x)/2^10,
          time=sapply(x,gettime)/60
        )}() |>
         remove_rownames() |>
         as_tibble() -> dat

dat |>
  rename(directory=dir) |>
  group_by(directory) |>
  summarize(size.kB=sum(size),time.min=sum(time)) |>
  arrange(-time.min) -> datsum

datsum |>
  mutate(
    size.kB=round(size.kB,0),
    time.min=round(time.min,1)
  ) |>
  rename(`size (kB)`=size.kB,`time (min)`=time.min)
```

The archives amount to about `r round(sum(datsum$size.kB)/1024,0)`&nbsp;MB.

Full compilation, i.e., rebuilding the complete set of materials following deletion of all archives, requires about `r datsum |> pull(time.min) |> sum(15) |> round(0)`&nbsp;min on a 250-processor cluster.
Full compilation regenerates the complete set of archives.
A finishing compilation, i.e., rebuilding with all archives in place, but with the re-Making of all documents, requires about 12&nbsp;min on a 64-cpu workstation.

----------------------------

### License

[![CC-BY-NC](https://i.creativecommons.org/l/by-nc/4.0/88x31.png)](https://creativecommons.org/licenses/by-nc/4.0/)

This work is licensed under the
[Creative Commons Attribution-NonCommercial 4.0 International License (CC BY-NC 4.0)](https://creativecommons.org/licenses/by-nc/4.0/).
Under its terms, you are free to:

-   Share &mdash; copy and redistribute the material in any medium or format
-   Adapt &mdash; remix, transform, and build upon the material

under the following terms:

-   Attribution &mdash; You must give appropriate credit, provide a link to the license, and indicate if changes were made.
	You may do so in any reasonable manner, but not in any way that suggests the licensor endorses you or your use.
-   NonCommercial &mdash; You may not use the material for commercial purposes.
-   No additional restrictions &mdash; You may not apply legal terms or technological measures that legally restrict others from doing anything the license permits.

The licensor cannot revoke these freedoms as long as you follow the license terms. 

----------------------------
